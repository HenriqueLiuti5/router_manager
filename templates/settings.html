<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurações - Router Manager</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='assets/router-manager.png') }}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/style-dashboard.css')}}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="sidebar">
        <div class="sidebar-brand">
            <i class="fa-solid fa-wifi"></i>
            <span class="link-text">Router Manager</span>
        </div>
        <ul class="sidebar-menu">
            <li class="{{ 'active' if request.endpoint == 'dashboard' else '' }}">
                <a href="{{ url_for('dashboard') }}">
                    <i class="fa-solid fa-chart-pie"></i>
                    <span class="link-text">Dashboard</span>
                </a>
            </li>
            <li class="{{ 'active' if request.endpoint == 'settings' else '' }}">
                <a href="{{ url_for('settings') }}">
                    <i class="fa-solid fa-gear"></i>
                    <span class="link-text">Configurações</span>
                </a>
            </li>
        </ul>
        <div class="sidebar-footer">
            <form action="{{ url_for('logout') }}" method="POST">
                <button type="submit" class="btn-sidebar-logout" title="Sair">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                    <span class="link-text">Sair</span>
                </button>
            </form>
            <span class="app-version">v1.0.0</span>
        </div>
    </nav>

    <main class="main-content">
        <header class="top-bar">
            <div class="user-welcome">
                <h1>Configurações</h1>
                <p>Gerencie suas preferências e segurança</p>
            </div>
            <div class="user-profile">
                <div class="avatar-circle">
                    {{ current_user.username[0] | upper }}
                </div>
                <div class="user-info">
                    <span class="name">{{ current_user.username }}</span>
                    <span class="role">{{ 'Administrador' if current_user.is_admin else 'Visualizador' }}</span>
                </div>
            </div>
        </header>

        <div class="table-container" style="max-width: 800px;">
            <div class="table-header">
                <div class="table-title">
                    <h2>Meu Perfil</h2>
                </div>
            </div>
            
            <div style="padding: 32px;">
                <div class="input-group">
                    <label>Nome de Usuário</label>
                    <input type="text" value="{{ current_user.username }}" disabled style="background-color: #f8fafc; cursor: not-allowed;">
                </div>

                <div class="input-group">
                    <label>E-mail</label>
                    <input type="email" value="{{ current_user.email }}" disabled style="background-color: #f8fafc; cursor: not-allowed;">
                </div>

                <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">
                    <h3 style="margin-bottom: 16px; font-size: 1rem;">Segurança</h3>
                    
                    <div id="flash-messages">
                        {% with messages = get_flashed_messages(with_categories=true) %}
                            {% if messages %}
                                {% for category, message in messages %}
                                    <div class="alert {{ 'alert-error' if category == 'error' else 'alert-success' }}">
                                        {{ message }}
                                    </div>
                                {% endfor %}
                            {% endif %}
                        {% endwith %}
                    </div>
                    
                    <form id="form-password" action="{{ url_for('new_password') }}" method="POST">
                        <div class="input-group">
                            <label>Nova Senha</label>
                            <input type="password" id="password" name="password" placeholder="Digite para alterar...">
                        </div>
                    
                        <div class="input-group">
                            <label>Confirmar Nova Senha</label>
                            <input type="password" id="confirm-password" name="confirm_password" placeholder="Repita a nova senha...">
                        </div>

                        <div style="margin-top: 32px; display: flex; justify-content: flex-end;">
                            <button type="submit" class="btn-primary">
                                <i class="fa-solid fa-floppy-disk"></i> Salvar Alterações
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.getElementById('form-password').addEventListener('submit', function(event) {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            const jsDiv = document.getElementById('js-messages');
            jsDiv.innerHTML = '';

            if (password !== confirmPassword) {
                event.preventDefault();
                
                const div = document.createElement('div');
                div.textContent = "As senhas não coincidem!";
                div.className = "alert alert-error";
                div.style.marginBottom = "15px";
                
                jsDiv.appendChild(div);
            }
        });
    </script>
</body>
</html>